---
title: "Fit-regression"
author: "S. Sethi"
date: '2018-04-16'
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


Choice of method:
1. Multinomial Logistic Regression is the linear regression analysis to conduct when the dependent variable is nominal with more than two levels

# Clean data

```{r message=FALSE, warning=FALSE}
source("data_wrangling.R")

dat <- t2dsci_data_wrangling("../data/Assessment_Latest.csv")
```

# Doing the Chi-squared test

Getting the table:
```{r}

tab <- with(dat, table(dat$X, dat$Y))
tab
```


```{r}
chisq.test(tab, correct = TRUE)
```

Thus, the chi-square test does not give us any relevant information about our model.

# Ordered Logistic Regression

Now, I will try to fit an ordinal regression model on our data as our Y variable is of the form 1-5.
```{r message=FALSE, warning=FALSE}
require(foreign)
require(ggplot2)
require(MASS)
require(Hmisc)
require(reshape2)
```


Starting with desciptive statitics:
```{r}
lapply(dat[, c("X", "Y", "C1", "C2", "C3")], table)
```


```{r}
# Three way cross tabs and flattening the table
# With confounding variable 1
ftable(xtabs(~X + C1 + Y, data = dat))
```


```{r}
# With confounding variable 2
ftable(xtabs(~X + C2 + Y, data = dat))
```

```{r}
# With confounding variable 3
ftable(xtabs(~X + C3 + Y, data = dat))
```

```{r}
o <- polr(Y ~ X, data = dat, Hess = TRUE)
summary(o)
```

Now, Will try to calcualte the p-values:
```{r}
coeff_tab <- coef(summary(o))
```

```{r}
# Calculate the p-values
p <- pnorm(abs(coeff_tab[, "t value"]), lower.tail = FALSE) * 2

# combining with the t-values and coeff table
coeff_tab <- cbind(coeff_tab, "p value" = p)
```

```{r}
ci <- confint(o)
```
```{r}
exp(coef(o))
```

```{r}
exp(cbind(OR = coef(o), ci))
```

For a one unit increase in a person having an experience in Programming, 

```{r}
df_pred <- data.frame(X = c("stats", "prog", "both", "neither"))
pred <- predict(o, newdata = df_pred, "probs")

```

```{r}
# Probabilties
df_X <- data.frame(X = c("stats", "prog", "both", "neither"), each=45)
pp_X <- cbind(df_X, predict(o, newdata = df_X, "probs", se=TRUE))
by(pp_X[,3:7], pp_X$X, colMeans)
```

